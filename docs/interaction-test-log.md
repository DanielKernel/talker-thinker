# Talker-Thinker 交互测试记录（专项）

> 用于沉淀真实对话回放与问题定位，支撑后续系统性交互体验优化与回归验证。

## 2026-02-20 会话A：打车任务全双工回放

### 原始片段（节选）
```
[17:17:36.129] 你: 打车
[17:21:43.493] Talker: 好的！您可以通过滴滴、高德等App快速打车...

[17:21:44.539] 你: 详细对比下滴滴和高德打车的优劣势...
[17:22:28.553] Talker: 好的，这个问题需要深度思考，已转交给Thinker处理
[17:22:49.995] 你: 有点慢
⚠️ 上一任务已被用户打断
⚠️ 任务已取消
```

### 问题判定
1. **播报不足**：转交 Thinker 后在预处理阶段反馈不足，用户感知响应慢。  
2. **语义误判**：“有点慢”应属于 COMMENT/QUERY_STATUS，却被当作 REPLACE（取消）。

### 已落地修复
1. 在协作模式前置阶段新增播报：`正在同步上下文并规划步骤，请稍候...`。  
2. 意图分类中将“补充信息”检测提前，降低被新任务规则误伤概率。  
3. `_is_likely_new_task` 动作关键词移除过宽词项，避免“有点慢”类误判。  
4. Thinker 将阶段说明写入 SharedContext，Talker 可据此播报更贴近当前阶段内容。

### 回归用例（已补充）
- `test_slow_comment_should_not_cancel`  
- `test_supplement_should_be_modify`  
- `test_collaboration_handoff_returns_on_clarification`（补充前置播报断言）  
- `test_latest_shared_step_desc`

### 后续观察点
- 复杂任务转交后 1-4 秒内是否必有 Talker 状态反馈。  
- “取消/停止/算了”与“补充/另外/再加”语义边界在短文本下是否稳定。  
- Talker 播报内容是否能随 Thinker 阶段变化而更新（分析/规划/执行/整合）。

## 2026-02-20 会话B：选车任务异常回放

### 原始片段（节选）
```
[17:34:39] 用户: 推荐下怎么选车
[17:34:49] Talker: 已转交Thinker + 正在同步上下文...

[17:35:05] 用户: 感觉有点慢
[Talker] 抱歉让您久等了，正在加速处理...

[17:35:17] 用户: 还在吗
[Talker] 正在处理...已用时29秒

[17:35:30] 用户: 有啥信息没
[17:35:32] Talker: 方便说说您的购车预算吗？
[17:35:32] 用户: 30万
[17:35:37] Talker: 收到，已更新您的需求信息

[17:36:19] 用户: 不想打车了，定个餐馆
系统仅取消旧任务，未继续新意图
```

### 问题判定
1. **主动进度播报不稳定**：预检查阶段缺少持续播报。  
2. **Thinker可见度不足**：用户难以感知Thinker是否在推进。  
3. **输入语义处理不足**：状态查询与补充信息路径不够清晰。  
4. **取消+新意图未衔接**：复合输入只触发取消，未自动进入新任务。

### 本轮修复
1. 协作预检查阶段改为异步任务 + 5秒周期主动播报。  
2. 增加 IDLE 阶段播报模板，避免长时间只播报一次。  
3. `QUERY_STATUS` 引入 SharedContext 阶段/步骤/最新中间结果反馈。  
4. `MODIFY` 实时写入 SharedContext（约束与补充信息）并继续任务。  
5. 新增 `extract_replacement_input`，支持从“取消+新任务”复合语句提取新意图（如“定个餐馆”）。  
6. 修复交互循环：任务被取消后若存在新意图，立即启动下一任务。

### 本轮新增回归测试
- `test_status_phrase_should_be_query_status`
- `test_extract_replacement_input`
- `test_idle_stage_broadcast_template`
