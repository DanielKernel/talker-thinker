# Talker-Thinker è¯„æµ‹ç³»ç»Ÿ

## æ¦‚è¿°

Talker-Thinker è¯„æµ‹ç³»ç»Ÿæ˜¯ä¸€ä¸ªå…¨é¢çš„è‡ªåŠ¨åŒ–è¯„æµ‹æ¡†æ¶ï¼Œç”¨äºè¯„ä¼°åŒ Agent ç³»ç»Ÿï¼ˆTalker å’Œ Thinkerï¼‰çš„æ€§èƒ½è¡¨ç°ã€‚

## è¯„æµ‹æ¶æ„

### åˆ†å±‚è¯„æµ‹è®¾è®¡

```
L1 å•å…ƒæµ‹è¯• â†’ ç»„ä»¶çº§åˆ« (Agentã€Skillsã€Context)
L2 é›†æˆæµ‹è¯• â†’ Agent ååŒã€Handoff æœºåˆ¶
L3 ç«¯åˆ°ç«¯è¯„æµ‹ â†’ å®Œæ•´ç”¨æˆ·åœºæ™¯
L4 è´¨é‡è¯„ä¼° â†’ ç­”æ¡ˆè´¨é‡ã€ç›¸å…³æ€§ã€å‡†ç¡®æ€§
```

### æ ¸å¿ƒè¯„æµ‹ç»´åº¦

| ç»´åº¦ | æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|------|
| å“åº”é€Ÿåº¦ | TTFT, TPS | Talker <500ms |
| æ„å›¾è¯†åˆ«å‡†ç¡®ç‡ | Classification Accuracy | >90% |
| Handoff æ­£ç¡®ç‡ | Correct Routing | >95% |
| ä»»åŠ¡å®Œæˆç‡ | Task Success Rate | >85% |
| ç­”æ¡ˆè´¨é‡ | Quality Score (0-100) | >80 |

## ç›®å½•ç»“æ„

```
evals/
â”œâ”€â”€ __init__.py              # æ¨¡å—å…¥å£
â”œâ”€â”€ __main__.py              # CLI å…¥å£
â”œâ”€â”€ harness.py               # è¯„æµ‹æ‰§è¡Œå¼•æ“
â”œâ”€â”€ assertions.py            # æ–­è¨€æ£€æŸ¥å™¨åº“
â”œâ”€â”€ cases/                   # è¯„æµ‹ç”¨ä¾‹é›†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ simple.py            # ç®€å•ä»»åŠ¡ (S001-S006)
â”‚   â”œâ”€â”€ medium.py            # ä¸­ç­‰ä»»åŠ¡ (M001-M006)
â”‚   â”œâ”€â”€ complex.py           # å¤æ‚ä»»åŠ¡ (C001-C006)
â”‚   â”œâ”€â”€ edge.py              # è¾¹ç•Œ/å¼‚å¸¸ (E001-E008)
â”‚   â”œâ”€â”€ conversation.py      # å¯¹è¯åœºæ™¯ (CX001-CX018) [æ–°å¢]
â”‚   â””â”€â”€ ux_quality.py        # ç”¨æˆ·ä½“éªŒè´¨é‡ (UQ001-UQ015) [æ–°å¢]
â”œâ”€â”€ metrics/                 # è¯„æµ‹æŒ‡æ ‡
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ latency.py           # æ—¶å»¶æŒ‡æ ‡
â”‚   â”œâ”€â”€ accuracy.py          # å‡†ç¡®ç‡æŒ‡æ ‡
â”‚   â”œâ”€â”€ quality.py           # è´¨é‡è¯„åˆ†
â”‚   â””â”€â”€ collector.py         # æŒ‡æ ‡æ”¶é›†å™¨
â”œâ”€â”€ reporters/               # æŠ¥å‘Šç”Ÿæˆ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ console.py           # æ§åˆ¶å°è¾“å‡º
â”‚   â”œâ”€â”€ json_reporter.py     # JSON å¯¼å‡º
â”‚   â””â”€â”€ html.py              # HTML æŠ¥å‘Š
â”œâ”€â”€ fixtures/                # æµ‹è¯•å›ºä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ mock_skills.py       # Mock æŠ€èƒ½
â”‚   â””â”€â”€ test_data.py         # æµ‹è¯•æ•°æ®
â””â”€â”€ results/                 # è¯„æµ‹ç»“æœ (ç”Ÿæˆ)
    â”œâ”€â”€ eval_result.json     # JSON ç»“æœ
    â””â”€â”€ eval_report.html     # HTML æŠ¥å‘Š
```

## å¿«é€Ÿå¼€å§‹

### è¿è¡Œè¯„æµ‹

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# è¿è¡Œå…¨éƒ¨è¯„æµ‹ (59 ä¸ªç”¨ä¾‹)
python -m evals run

# è¿è¡Œè¯„æµ‹å¹¶ç”ŸæˆæŠ¥å‘Š
python -m evals run -v --output result.json --html

# è¿è¡Œç‰¹å®šç±»åˆ«çš„è¯„æµ‹
python -m evals run --category simple
python -m evals run --category complex
python -m evals run --category conversation   # å¯¹è¯åœºæ™¯
python -m evals run --category ux_quality     # ç”¨æˆ·ä½“éªŒè´¨é‡
```

### åˆ—å‡ºè¯„æµ‹ç”¨ä¾‹

```bash
# åˆ—å‡ºæ‰€æœ‰ç”¨ä¾‹
python -m evals list

# åˆ—å‡ºç‰¹å®šç±»åˆ«ç”¨ä¾‹
python -m evals list --category complex
```

### ç”ŸæˆæŠ¥å‘Š

```bash
# ä» JSON ç”Ÿæˆ HTML æŠ¥å‘Š
python -m evals report --input result.json --format html

# åœ¨æ§åˆ¶å°æ˜¾ç¤ºæŠ¥å‘Š
python -m evals report --input result.json --format console
```

## CLI å‘½ä»¤è¯¦è§£

### `run` - è¿è¡Œè¯„æµ‹

```bash
python -m evals run [é€‰é¡¹]

é€‰é¡¹:
  --category, -c     è¿è¡Œç‰¹å®šç±»åˆ« (simple/medium/complex/edge/conversation/ux_quality)
  --output, -o       è¾“å‡º JSON æ–‡ä»¶è·¯å¾„
  --html, -H         ç”Ÿæˆ HTML æŠ¥å‘Š
  --verbose, -v      æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
  --real-llm         ä½¿ç”¨çœŸå® LLM (é»˜è®¤ä½¿ç”¨ Mock)
  --timeout          ç”¨ä¾‹è¶…æ—¶æ—¶é—´ (ç§’)
  --latency          Mock å“åº”å»¶è¿Ÿ (ms)
```

### `list` - åˆ—å‡ºç”¨ä¾‹

```bash
python -m evals list [é€‰é¡¹]

é€‰é¡¹:
  --category, -c     åˆ—å‡ºç‰¹å®šç±»åˆ«çš„ç”¨ä¾‹ (simple/medium/complex/edge/conversation/ux_quality)
```

### `report` - ç”ŸæˆæŠ¥å‘Š

```bash
python -m evals report --input <æ–‡ä»¶> [é€‰é¡¹]

é€‰é¡¹:
  --input, -i        è¾“å…¥ JSON æ–‡ä»¶ (å¿…éœ€)
  --output, -o       è¾“å‡ºæ–‡ä»¶è·¯å¾„
  --format, -f       æŠ¥å‘Šæ ¼å¼ (json/html/console)
```

## è¯„æµ‹ç”¨ä¾‹è®¾è®¡

### ç”¨ä¾‹ç»“æ„

æ¯ä¸ªè¯„æµ‹ç”¨ä¾‹ (`EvalCase`) åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

```python
@dataclass
class EvalCase:
    case_id: str                        # å”¯ä¸€æ ‡è¯† (å¦‚ S001, M001)
    name: str                           # ç”¨ä¾‹åç§°
    description: str                    # æè¿°
    category: EvalCategory              # ç±»åˆ«
    user_input: str                     # ç”¨æˆ·è¾“å…¥
    expected_complexity: TaskComplexity # æœŸæœ›å¤æ‚åº¦
    expected_agent: AgentRole           # æœŸæœ›å¤„ç† Agent
    assertions: List[Assertion]         # æ–­è¨€åˆ—è¡¨
    golden_output: Optional[str]        # æœŸæœ›è¾“å‡º (å¯é€‰)
    priority: Priority                  # ä¼˜å…ˆçº§
    tags: List[str]                     # æ ‡ç­¾
    context_messages: List[Dict]        # å‰ç½®ä¸Šä¸‹æ–‡
```

### æ–­è¨€è®¾è®¡

```python
@dataclass
class Assertion:
    name: str                        # æ–­è¨€åç§°
    checker: Callable                # æ£€æŸ¥å‡½æ•°
    weight: float                    # æƒé‡
    failure_reason_template: str     # å¤±è´¥åŸå› æ¨¡æ¿
    description: str                 # æè¿°
```

### ç”¨ä¾‹åˆ†ç±»

#### ç®€å•ä»»åŠ¡ (Simple, S001-S006)
- é—®å€™å“åº”
- ç®€å•è®¡ç®—
- æ—¶é—´æŸ¥è¯¢
- è®°å¿†å¬å›
- è‡ªæˆ‘ä»‹ç»
- æ„Ÿè°¢å›åº”

#### ä¸­ç­‰ä»»åŠ¡ (Medium, M001-M006)
- å¤©æ°”æŸ¥è¯¢
- å•ä½è½¬æ¢
- ç”µå½±æ¨è
- ç¿»è¯‘
- å®šä¹‰è§£é‡Š
- ç®€å•æ¯”è¾ƒ

#### å¤æ‚ä»»åŠ¡ (Complex, C001-C006)
- æ·±åº¦åˆ†æ
- äº§å“å¯¹æ¯”
- æ—…è¡Œè§„åˆ’
- é—®é¢˜æ’æŸ¥
- ç³»ç»Ÿè®¾è®¡
- å­¦æœ¯å†™ä½œ

#### è¾¹ç•Œ/å¼‚å¸¸ (Edge, E001-E008)
- ç©ºè¾“å…¥
- è¶…é•¿è¾“å…¥
- å¤šè¯­è¨€æ··åˆ
- æ¨¡ç³ŠæŸ¥è¯¢
- ç‰¹æ®Šå­—ç¬¦
- é‡å¤é—®é¢˜
- æ•æ„Ÿè¯é¢˜
- æŒ‡ä»¤æ³¨å…¥å°è¯•

#### å¯¹è¯åœºæ™¯ (Conversation, CX001-CX018) [æ–°å¢]
- **å¤šè½®å¯¹è¯è¿è´¯æ€§**: ä»£è¯æŒ‡ä»£ã€è¯é¢˜å»¶ç»­ã€ä»»åŠ¡åˆ†è§£
- **ä¸Šä¸‹æ–‡ç†è§£**: å®ä½“å›å¿†ã€æ„å›¾æ¨æ–­
- **æƒ…æ„Ÿæ™ºèƒ½**: æƒ…ç»ªè¯†åˆ«ã€ç§¯æå›åº”ã€æŒ«æŠ˜å®‰æŠš
- **ä¸ªæ€§åŒ–**: åå¥½è®°å¿†ã€èº«ä»½è®¤çŸ¥
- **ä»»åŠ¡å®Œæˆåº¦**: å¤šæ­¥è·Ÿè¸ªã€ä¸­æ–­æ¢å¤
- **äº¤äº’è‡ªç„¶åº¦**: å¼€åœºã€ç»“æŸã€è¿½é—®å¤„ç†
- **ç‰¹æ®Šåœºæ™¯**: æ¨¡ç³Šè¯·æ±‚ã€æ•æ„Ÿè¯é¢˜ã€çŸ¥è¯†è¾¹ç•Œ

#### ç”¨æˆ·ä½“éªŒè´¨é‡ (UX Quality, UQ001-UQ015) [æ–°å¢]
- **å›ç­”å‡†ç¡®æ€§**: äº‹å®ã€è®¡ç®—ã€æ—¶æ•ˆæ€§
- **ä¿¡æ¯å®Œæ•´æ€§**: å¤šéƒ¨åˆ†é—®é¢˜ã€èƒŒæ™¯ä¿¡æ¯
- **è¡¨è¾¾æ¸…æ™°åº¦**: ç»“æ„åŒ–ã€ç®€æ´æ€§
- **æœ‰ç”¨æ€§**: å¯æ“ä½œæ€§å»ºè®®ã€é—®é¢˜è§£å†³å¯¼å‘
- **å®‰å…¨æ€§**: å±é™©æ‹’ç»ã€éšç§ä¿æŠ¤
- **ä¸“ä¸šåº¦**: é¢†åŸŸå›ç­”ã€ä¸ç¡®å®šæ€§è¡¨è¾¾ã€çŸ¥è¯†è¾¹ç•Œè¯šå®
- **ç»¼åˆè´¨é‡**: ç»¼åˆå›ç­”è´¨é‡è¯„ä¼°

## è¯„æµ‹æŠ¥å‘Š

### æ§åˆ¶å°æŠ¥å‘Š

æ§åˆ¶å°æŠ¥å‘ŠåŒ…å«ï¼š
- åŸºæœ¬ä¿¡æ¯ï¼ˆè¯„æµ‹ IDã€æ—¶é—´ã€è€—æ—¶ï¼‰
- æ€»ä½“æ¦‚è§ˆï¼ˆé€šè¿‡ç‡ã€å¹³å‡å¾—åˆ†ã€å“åº”æ—¶é—´ï¼‰
- åˆ†ç±»ç»Ÿè®¡ï¼ˆæŒ‰éš¾åº¦åˆ†ç»„ï¼‰
- å¤±è´¥åŸå› åˆ†å¸ƒ
- è¯¦ç»†ç»“æœï¼ˆæ¯ä¸ªç”¨ä¾‹ï¼‰
- ç›®æ ‡è¾¾æˆæƒ…å†µ
- æ”¹è¿›å»ºè®®

### HTML æŠ¥å‘Š

HTML æŠ¥å‘Šæä¾›ï¼š
- å¯è§†åŒ–ä»ªè¡¨æ¿
- å½©è‰²çŠ¶æ€æŒ‡ç¤ºå™¨
- äº¤äº’å¼è¡¨æ ¼
- å“åº”å¼è®¾è®¡

### JSON å¯¼å‡º

JSON æ ¼å¼ä¾¿äºï¼š
- è‡ªåŠ¨åŒ–å¤„ç†
- å†å²å¯¹æ¯”
- é›†æˆåˆ° CI/CD

## å¤±è´¥åŸå› åˆ†ç±»

```python
class FailureReason(Enum):
    WRONG_AGENT = "wrong_agent"         # è·¯ç”±é”™è¯¯
    TIMEOUT = "timeout"                 # è¶…æ—¶
    WRONG_OUTPUT = "wrong_output"       # è¾“å‡ºé”™è¯¯
    SKILL_FAILED = "skill_failed"       # æŠ€èƒ½è°ƒç”¨å¤±è´¥
    ASSERTION_FAILED = "assertion_failed" # æ–­è¨€å¤±è´¥
    EXCEPTION = "exception"             # å¼‚å¸¸
    HANDOFF_FAILED = "handoff_failed"   # Handoff å¤±è´¥
    CONTEXT_LOST = "context_lost"       # ä¸Šä¸‹æ–‡ä¸¢å¤±
```

## æ‰©å±•è¯„æµ‹ç³»ç»Ÿ

### æ·»åŠ æ–°ç”¨ä¾‹

```python
# åœ¨ evals/cases/ ä¸‹åˆ›å»ºæˆ–ç”¨ä¾‹æ–‡ä»¶
from context.types import AgentRole, TaskComplexity
from ..core.types import Assertion, EvalCase, EvalCategory, Priority

NEW_CASES = [
    EvalCase(
        case_id="X001",
        name="new_feature_test",
        description="æµ‹è¯•æ–°åŠŸèƒ½",
        category=EvalCategory.MEDIUM,
        user_input="æµ‹è¯•è¾“å…¥",
        expected_complexity=TaskComplexity.MEDIUM,
        expected_agent=AgentRole.TALKER,
        assertions=[
            Assertion(
                name="response_time_check",
                checker=lambda response_time_ms, **_: response_time_ms < 500,
                weight=1.0,
                failure_reason_template="å“åº”æ—¶é—´è¶…è¿‡ 500ms",
                description="å“åº”æ—¶é—´åº”å°äº 500ms",
            ),
        ],
        priority=Priority.HIGH,
    ),
]

def get_cases() -> list:
    return NEW_CASES
```

### æ·»åŠ æ–°æ–­è¨€

```python
# åœ¨ evals/assertions.py ä¸­æ·»åŠ æ–°æ£€æŸ¥å‡½æ•°
def check_new_feature(actual_output: str, **kwargs) -> bool:
    """æ£€æŸ¥æ–°åŠŸèƒ½"""
    return "expected" in actual_output.lower()
```

## æœ€ä½³å®è·µ

1. **è¿è¡Œå‰å‡†å¤‡**: ç¡®ä¿é…ç½®å¥½ Mock LLM è¿›è¡Œæµ‹è¯•
2. **å®šæœŸè¯„æµ‹**: æ¯æ¬¡é‡å¤§æ”¹åŠ¨åè¿è¡Œå®Œæ•´è¯„æµ‹
3. **åˆ†æå¤±è´¥**: æŸ¥çœ‹å¤±è´¥åŸå› åˆ†å¸ƒï¼Œä¼˜å…ˆä¿®å¤é«˜é¢‘é—®é¢˜
4. **å†å²å¯¹æ¯”**: ä¿å­˜ JSON ç»“æœç”¨äºè¶‹åŠ¿åˆ†æ
5. **CI/CD é›†æˆ**: åœ¨ GitHub Actions ä¸­è‡ªåŠ¨è¿è¡Œè¯„æµ‹

## ç¤ºä¾‹è¾“å‡º

```
================================================================================
                              Talker-Thinker è¯„æµ‹æŠ¥å‘Š
================================================================================

ğŸ“Š åŸºæœ¬ä¿¡æ¯
------------------------------------------------------------
  è¯„æµ‹ ID:        f5a2ccdc...
  è¯„æµ‹æ—¶é—´ï¼š2026-02-22 13:18:18
  è€—æ—¶ï¼š15.03 ç§’

ğŸ“ˆ æ€»ä½“æ¦‚è§ˆ
------------------------------------------------------------
  æ€»ç”¨ä¾‹æ•°ï¼š26
  é€šè¿‡ç”¨ä¾‹ï¼š18 (69.2%)
  å¤±è´¥ç”¨ä¾‹ï¼š8 (30.8%)
  å¹³å‡å¾—åˆ†ï¼š88.1/100
  å¹³å‡å“åº”æ—¶é—´ï¼š576.9ms

ğŸ“‹ åˆ†ç±»ç»Ÿè®¡
------------------------------------------------------------
  ç®€å•ä»»åŠ¡ï¼š100.0% é€šè¿‡ç‡ï¼Œ150.0ms å¹³å‡å“åº”
  ä¸­ç­‰ä»»åŠ¡ï¼š83.3% é€šè¿‡ç‡ï¼Œ150.0ms å¹³å‡å“åº”
  å¤æ‚ä»»åŠ¡ï¼š0.0% é€šè¿‡ç‡ï¼Œ1691.7ms å¹³å‡å“åº”
  è¾¹ç•Œ/å¼‚å¸¸ï¼š87.5% é€šè¿‡ç‡ï¼Œ381.2ms å¹³å‡å“åº”

ğŸ¯ ç›®æ ‡è¾¾æˆæƒ…å†µ
------------------------------------------------------------
  âœ… å“åº”é€Ÿåº¦ï¼šå®é™… 576.9ms (ç›®æ ‡ <500ms)
  âŒ é€šè¿‡ç‡ï¼šå®é™… 69.2% (ç›®æ ‡ >85%)
  âœ… å¹³å‡å¾—åˆ†ï¼šå®é™… 88.1 (ç›®æ ‡ >80)
```

## æ•…éšœæ’é™¤

**é—®é¢˜**: æ–­è¨€æ£€æŸ¥æŠ¥é”™ `'<=' not supported between instances of 'AgentRole' and 'int'`

**è§£å†³**: ç¡®ä¿æ–­è¨€çš„ lambda å‡½æ•°ä½¿ç”¨æ­£ç¡®çš„å‚æ•°åï¼ˆ`response_time_ms` è€Œé`actual`ï¼‰

**é—®é¢˜**: HTML æŠ¥å‘Šæ— æ³•ç”Ÿæˆ

**è§£å†³**: æ£€æŸ¥ `evals/results/` ç›®å½•æ˜¯å¦å­˜åœ¨ä¸”å¯å†™

**é—®é¢˜**: å¤æ‚ä»»åŠ¡å…¨éƒ¨å¤±è´¥

**è§£å†³**: æ£€æŸ¥ Mock Thinker çš„è¾“å‡ºé•¿åº¦æ˜¯å¦æ»¡è¶³æ–­è¨€è¦æ±‚
